# InfraForge GitOps Platform Configuration
# Single source of truth for all applications and infrastructure

# Global settings
domain: "ticarethanem.net"
environment: "production"

aws:
  region: "eu-west-1"
  account_id: "715841344657"
  # Certificate ARN will be output from OpenTofu after first apply
  # Update this after initial tofu apply
  acm_certificate_arn: ""  # Will be populated by tofu output

# Infrastructure Components (Enable/Disable)
infrastructure:
  # ============================================================================
  # AWS Managed Databases
  # ============================================================================
  rds:
    mysql:
      enabled: false  # External RDS MySQL - DISABLED (using internal CloudNativePG)
      engine_version: "8.0.35"
      instance_class: "db.t3.micro"
      allocated_storage: 20
      multi_az: false
      backup_retention_days: 7
    postgresql:
      enabled: false  # External RDS PostgreSQL - DISABLED (using internal CloudNativePG)
      engine_version: "15.4"
      instance_class: "db.t3.micro"
      allocated_storage: 20
      multi_az: false
      backup_retention_days: 7

  # ============================================================================
  # AWS Managed Services (External)
  # ============================================================================
  elasticache:
    enabled: false  # Redis/Memcached managed by AWS
    engine: "redis"
    node_type: "cache.t3.micro"
    num_cache_nodes: 1
    engine_version: "7.0"
    parameter_group_family: "redis7"

  amazon_mq:
    enabled: false  # Managed RabbitMQ/ActiveMQ
    engine_type: "RabbitMQ"
    engine_version: "3.11.20"
    host_instance_type: "mq.t3.micro"
    deployment_mode: "SINGLE_INSTANCE"

  msk:
    enabled: false  # Managed Kafka
    kafka_version: "3.5.1"
    instance_type: "kafka.t3.small"
    number_of_broker_nodes: 3
    ebs_volume_size: 100

  sqs:
    enabled: false  # SQS queues
    create_dlq: true  # Create Dead Letter Queues

  # ============================================================================
  # Container Registry
  # ============================================================================
  ecr:
    enabled: true
    create_for_disabled_apps: true

  # ============================================================================
  # DNS & Certificates
  # ============================================================================
  route53:
    enabled: true
  acm:
    enabled: true

  # ============================================================================
  # Secrets Management
  # ============================================================================
  external_secrets:
    enabled: true  # External Secrets Operator
    secrets_manager:
      enabled: true  # Use AWS Secrets Manager
      region: "eu-west-1"

  # ============================================================================
  # Monitoring Stack
  # ============================================================================
  monitoring:
    prometheus:
      enabled: true
      retention: "15d"
      storage_size: "50Gi"
      replicas: 2
    grafana:
      enabled: true
      admin_password: ""  # Auto-generated by Terraform (random_password)
      persistence_enabled: true
      storage_size: "10Gi"
    alertmanager:
      enabled: true
      replicas: 2

  # ============================================================================
  # Logging & Tracing Stack
  # ============================================================================
  logging:
    loki:
      enabled: false  # DISABLED - Missing Grafana Agent CRDs
      retention_days: 30
      storage_size: "100Gi"
    opentelemetry:
      enabled: true  # ENABLED - cert-manager installed
      traces_enabled: true
      logs_enabled: true
      metrics_enabled: true

  # ============================================================================
  # Backup & Disaster Recovery
  # ============================================================================
  backup:
    velero:
      enabled: false  # DISABLED - Config format changed, needs update
      s3_bucket: "infraforge-velero-backups"
      backup_schedule: "0 2 * * *"  # Daily at 2 AM
      retention_days: 30

  # ============================================================================
  # Internal Operators (Running in EKS)
  # ============================================================================
  internal_operators:
    cloudnative_pg:
      enabled: true  # PostgreSQL Operator
      default_instances: 3
      storage_size: "10Gi"
    redis_operator:
      enabled: false  # DISABLED - Chart version not found
      default_replicas: 3
      storage_size: "5Gi"
    rabbitmq_operator:
      enabled: false  # DISABLED - Chart version not found
      default_replicas: 3
      storage_size: "10Gi"
    mongodb_operator:
      enabled: false  # MongoDB Community Operator - disabled for now
      default_replicas: 3
      storage_size: "10Gi"
    strimzi_kafka:
      enabled: true  # Kafka Operator (Strimzi)
      default_replicas: 3
      storage_size: "50Gi"
      zookeeper_replicas: 3

# Applications
applications:
  smk:
    enabled: false  # DISABLED - No image yet
    namespace: smk
    subdomain: smk                    # → smk.ticarethanem.net
    replicas: 2
    ecr:
      enabled: true                   # Create ECR repo for custom image
    image:
      repository_name: smk            # ECR repo name
      tag: latest
    resources:
      cpu: "500m"
      memory: "512Mi"
    ingress:
      enabled: true
      path: /
    database:
      type: mysql                     # mysql or postgresql
      name: smk_db
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 75

  sonsuzenerji:
    enabled: false  # DISABLED - No image yet
    namespace: sonsuzenerji
    subdomain: sonsuz               # → sonsuz.ticarethanem.net
    replicas: 2
    ecr:
      enabled: true                 # Create ECR repo for custom image
    image:
      repository_name: sonsuzenerji
      tag: latest
    resources:
      cpu: "500m"
      memory: "512Mi"
    ingress:
      enabled: true
      path: /
    database:
      type: postgresql
      name: sonsuzenerji_db
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 75

  transferhub:
    enabled: false                    # ← DISABLED (no resources created)
    namespace: transferhub
    subdomain: transfer              # → transfer.ticarethanem.net
    replicas: 2
    ecr:
      enabled: true                  # Create ECR repo for custom image
    image:
      repository_name: transferhub
      tag: latest
    resources:
      cpu: "500m"
      memory: "512Mi"
    ingress:
      enabled: true
      path: /
    database:
      type: mysql
      name: transferhub_db
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 75

  dronesight:
    enabled: false                    # ← DISABLED
    namespace: dronesight
    subdomain: drone                 # → drone.ticarethanem.net
    replicas: 2
    ecr:
      enabled: true                  # Create ECR repo for custom image
    image:
      repository_name: dronesight
      tag: latest
    resources:
      cpu: "500m"
      memory: "512Mi"
    ingress:
      enabled: true
      path: /
    database:
      type: postgresql
      name: dronesight_db
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 75

  # ============================================================================
  # OpenTelemetry Demo - Microservices Demo App
  # ============================================================================
  # Note: otel-demo uses its own official Helm chart (not generic infraforge-app)
  # Managed via standalone ArgoCD Application: argocd/otel-demo-app.yaml
  otel-demo:
    enabled: true  # ENABLED - Managed by Terraform via standalone Application
    namespace: otel-demo
    subdomain: otel                  # → otel.ticarethanem.net
    replicas: 1
    ecr:
      enabled: false                 # Uses official image (no custom ECR needed)
    image:
      repository_name: otel-demo     # Using official OpenTelemetry demo
      tag: latest
    resources:
      cpu: "100m"
      memory: "128Mi"
    ingress:
      enabled: true
      path: /
    database:
      type: none  # Demo uses internal services
      name: ""
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 75
